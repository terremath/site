<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Repère de Frenet — Animation</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  :root {
    --bg: #0a0e1a; --card: #111827; --border: #1e293b;
    --text: #e2e8f0; --dim: #94a3b8; --accent: #22d3ee;
    --tangent: #22d3ee; --normal: #f472b6; --at: #facc15;
    --an: #fb923c; --atotal: #ef4444; --osc: #1e3a5f;
  }
  body {
    background: var(--bg); color: var(--text);
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
    min-height: 100vh; overflow-x: hidden;
    padding: 12px; padding-bottom: 24px;
  }
  h1 {
    font-family: 'Playfair Display', serif; font-weight: 400;
    font-size: 22px; text-align: center; letter-spacing: -0.02em;
    background: linear-gradient(135deg, #22d3ee, #a78bfa, #f472b6);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: 2px;
  }
  .subtitle {
    font-family: 'Playfair Display', serif; font-style: italic;
    color: var(--dim); font-size: 12px; text-align: center; margin-bottom: 12px;
  }
  .card {
    background: var(--card); border-radius: 10px;
    border: 1px solid var(--border); margin-bottom: 10px; overflow: hidden;
  }
  #canvasWrap { position: relative; }
  canvas { display: block; width: 100%; touch-action: none; }
  .overlay {
    position: absolute; background: rgba(10,14,26,0.85);
    backdrop-filter: blur(8px); border-radius: 6px;
    padding: 7px 10px; border: 1px solid var(--border);
    font-size: 10px; line-height: 1.7;
  }
  .legend { top: 8px; left: 8px; }
  .measures { top: 8px; right: 8px; min-width: 110px; }
  .measures .label { color: var(--dim); font-family: 'Playfair Display', serif; font-style: italic; margin-bottom: 1px; }
  .measures span { color: var(--accent); }
  .controls { padding: 12px; }
  .section-label {
    font-size: 9px; color: var(--dim); text-transform: uppercase;
    letter-spacing: 0.1em; margin-bottom: 6px;
  }
  .btn-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
  .btn {
    padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border);
    background: transparent; color: var(--dim); cursor: pointer;
    font-size: 11px; font-family: 'JetBrains Mono', monospace;
    transition: all 0.2s; letter-spacing: 0.02em;
  }
  .btn.active { border-color: var(--accent); background: rgba(34,211,238,0.12); color: var(--accent); }
  .play-btn { min-width: 64px; font-weight: 500; }
  .slider-wrap { flex: 1; min-width: 120px; }
  .slider-wrap label { font-size: 9px; color: var(--dim); text-transform: uppercase; letter-spacing: 0.1em; display: block; margin-bottom: 3px; }
  input[type=range] { width: 100%; accent-color: var(--accent); height: 20px; }
  .flex-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
  .formulas { padding: 12px; }
  .formula-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .formula-card {
    padding: 8px 10px; border-radius: 6px; font-size: 12px;
    font-family: 'Playfair Display', serif; font-style: italic;
  }
  .formula-card.t { background: rgba(34,211,238,0.05); border: 1px solid rgba(34,211,238,0.15); }
  .formula-card.n { background: rgba(244,114,182,0.05); border: 1px solid rgba(244,114,182,0.15); }
  .formula-card.k { background: rgba(250,204,21,0.05); border: 1px solid rgba(250,204,21,0.15); }
  .formula-card.a { background: rgba(239,68,68,0.05); border: 1px solid rgba(239,68,68,0.15); grid-column: 1 / -1; }
</style>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=EB+Garamond:ital,wght@0,500;1,500&display=swap" rel="stylesheet">
</head>
<body>
<style>
.tm-nav {
  --nav-h: 180px;
  position: relative;
  width: 100%;
  height: var(--nav-h);
  background: #0a0805;
  box-sizing: border-box;
  font-family: 'Cormorant Garamond', Georgia, serif;
  overflow: visible;
  z-index: 100;
}
.tm-nav::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg,
    transparent 0%, rgba(201,168,76,0.4) 20%,
    rgba(201,168,76,0.85) 50%, rgba(201,168,76,0.4) 80%, transparent 100%);
  z-index: 20; pointer-events: none;
}
.tm-inner {
  position: absolute;
  inset: 0;
  overflow: hidden;
  pointer-events: none;
}
.tm-f {
  position: absolute;
  font-family: 'EB Garamond', Georgia, serif;
  font-style: italic;
  font-weight: 500;
  color: #c9a84c;
  white-space: nowrap;
  opacity: 0;
  text-shadow: 0 0 16px rgba(201,168,76,0.9), 0 0 32px rgba(201,168,76,0.35);
  animation: tm-formula-life 4.2s ease forwards;
}
.tm-f:nth-child(1)  { animation-delay: 0.00s; }
.tm-f:nth-child(2)  { animation-delay: 0.11s; }
.tm-f:nth-child(3)  { animation-delay: 0.22s; }
.tm-f:nth-child(4)  { animation-delay: 0.33s; }
.tm-f:nth-child(5)  { animation-delay: 0.44s; }
.tm-f:nth-child(6)  { animation-delay: 0.55s; }
.tm-f:nth-child(7)  { animation-delay: 0.66s; }
.tm-f:nth-child(8)  { animation-delay: 0.77s; }
.tm-f:nth-child(9)  { animation-delay: 0.88s; }
.tm-f:nth-child(10) { animation-delay: 0.99s; }
.tm-f:nth-child(11) { animation-delay: 1.10s; }
.tm-f:nth-child(12) { animation-delay: 1.21s; }
.tm-f:nth-child(13) { animation-delay: 1.32s; }
.tm-f:nth-child(14) { animation-delay: 1.43s; }
.tm-f:nth-child(15) { animation-delay: 1.54s; }
.tm-f:nth-child(16) { animation-delay: 1.65s; }
.tm-f:nth-child(17) { animation-delay: 1.76s; }
.tm-f:nth-child(18) { animation-delay: 1.87s; }
.tm-f:nth-child(19) { animation-delay: 1.98s; }
.tm-f:nth-child(20) { animation-delay: 2.09s; }
.tm-f:nth-child(21) { animation-delay: 2.20s; }
.tm-f:nth-child(22) { animation-delay: 2.31s; }
.tm-f:nth-child(23) { animation-delay: 2.42s; }
.tm-f:nth-child(24) { animation-delay: 2.53s; }
@keyframes tm-formula-life {
  0%   { opacity: 0; }
  8%   { opacity: 1; }
  75%  { opacity: 1; }
  100% { opacity: 0; }
}
.tm-center-logo {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(1);
  z-index: 10;
  display: flex; flex-direction: column;
  align-items: center; gap: 6px;
  opacity: 0; pointer-events: none;
  animation: tm-center-appear 1.4s cubic-bezier(.4,0,.2,1) 4.3s forwards;
}
.tm-center-logo img {
  width: 80px; height: 80px;
  border-radius: 50%;
  border: 2px solid rgba(201,168,76,0.65);
  box-shadow: 0 0 28px rgba(201,168,76,0.4), 0 0 55px rgba(201,168,76,0.14);
  object-fit: cover; display: block;
}
.tm-center-logo .tm-ctitle {
  display: flex; flex-direction: column;
  align-items: center; line-height: 1.1;
}
.tm-center-logo .tm-ctitle span {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 700; font-size: 1.45rem;
  color: #e2c06a; letter-spacing: 8px;
  text-transform: uppercase;
  text-shadow: 0 0 28px rgba(201,168,76,0.55), 0 2px 4px rgba(0,0,0,0.7);
}
@keyframes tm-center-appear {
  0%   { opacity: 0; transform: translate(-50%,-50%) scale(0.35); filter: blur(14px); }
  35%  { opacity: 1; filter: blur(0);  transform: translate(-50%,-50%) scale(1.05); }
  60%  { opacity: 1; transform: translate(-50%,-50%) scale(1); }
  85%  { opacity: 1; transform: translate(-50%,-50%) scale(1); }
  100% { opacity: 0; transform: translate(-130%,-50%) scale(0.65); }
}
.tm-left-logo {
  position: absolute;
  top: 50%; left: 16px;
  transform: translateY(-50%);
  z-index: 15;
  display: flex; align-items: center; gap: 10px;
  opacity: 0; text-decoration: none;
  animation: tm-fadein 0.7s ease 5.7s forwards;
  max-width: 220px;
}
.tm-left-logo img {
  width: 50px; height: 50px;
  border-radius: 50%;
  border: 2px solid rgba(201,168,76,0.55);
  box-shadow: 0 0 18px rgba(201,168,76,0.28);
  object-fit: cover; flex-shrink: 0;
}
.tm-left-logo .tm-ltitle {
  display: flex; flex-direction: column; line-height: 1.15;
}
.tm-left-logo .tm-ltitle span {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 700; font-size: 0.85rem;
  color: #e2c06a; letter-spacing: 3px;
  text-transform: uppercase;
  text-shadow: 0 0 14px rgba(201,168,76,0.45), 0 1px 3px rgba(0,0,0,0.8);
}
@keyframes tm-fadein { from { opacity:0; } to { opacity:1; } }
.tm-menu {
  position: absolute;
  top: 50%; right: 16px;
  transform: translateY(-50%);
  z-index: 200;
  display: flex; align-items: center; gap: 0;
  opacity: 0;
  animation: tm-fadein 0.7s ease 6.2s forwards;
}
.tm-menu > a,
.tm-dd > a {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 600; font-size: 0.78rem;
  color: rgba(201,168,76,0.88);
  text-decoration: none; letter-spacing: 2px;
  text-transform: uppercase;
  padding: 8px 8px;
  border: 1px solid transparent; border-radius: 2px;
  transition: color 0.25s, border-color 0.25s, text-shadow 0.25s;
  white-space: nowrap; display: inline-block;
}
.tm-menu > a:hover,
.tm-dd > a:hover {
  color: #e2c06a;
  border-color: rgba(201,168,76,0.32);
  text-shadow: 0 0 12px rgba(201,168,76,0.5);
}
.tm-dd { position: relative; }
.tm-dd-panel {
  display: none;
  position: absolute;
  top: 100%; left: 0;
  min-width: 220px;
  background: rgba(7,5,2,0.97);
  border: 1px solid rgba(201,168,76,0.2);
  border-top: 2px solid rgba(201,168,76,0.55);
  padding: 6px 0;
  z-index: 9999;
  box-shadow: 0 10px 36px rgba(0,0,0,0.7);
}
.tm-dd:hover .tm-dd-panel { display: block; }
.tm-dd-panel a {
  display: block;
  font-family: 'Cormorant Garamond', serif;
  font-weight: 600; font-size: 0.8rem;
  letter-spacing: 2px; text-transform: uppercase;
  text-decoration: none; padding: 10px 20px;
  color: rgba(201,168,76,0.7);
  transition: color 0.2s, background 0.2s;
}
.tm-dd-panel a:hover { color: #e2c06a; background: rgba(201,168,76,0.06); }
#tm-toggle { display: none; }
.tm-hamburger {
  display: none;
  position: absolute;
  top: 50%; right: 18px;
  transform: translateY(-50%);
  z-index: 300;
  cursor: pointer;
  padding: 8px;
  flex-direction: column; gap: 6px;
}
.tm-hamburger span {
  display: block;
  width: 26px; height: 2px;
  background: #e2c06a; border-radius: 2px;
  transition: transform 0.3s, opacity 0.3s;
  transform-origin: center;
}
.tm-nav.drawer-open .tm-hamburger span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
.tm-nav.drawer-open .tm-hamburger span:nth-child(2) { opacity: 0; }
.tm-nav.drawer-open .tm-hamburger span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
.tm-drawer {
  position: absolute;
  top: 100%; left: 0; right: 0;
  background: rgba(7,5,2,0.98);
  border-bottom: 1px solid rgba(201,168,76,0.2);
  z-index: 25; max-height: 0; overflow: hidden;
  transition: max-height 0.4s ease;
}
.tm-nav.drawer-open .tm-drawer { max-height: 600px; }
.tm-drawer-inner { padding: 10px 0 24px; }
.tm-drawer a {
  display: block;
  font-family: 'Cormorant Garamond', serif;
  font-weight: 600; font-size: 1.05rem;
  color: rgba(201,168,76,0.8); text-decoration: none;
  letter-spacing: 3px; text-transform: uppercase;
  padding: 13px 28px;
  border-bottom: 1px solid rgba(201,168,76,0.06);
  transition: color 0.2s, background 0.2s;
}
.tm-drawer a:hover { color: #e2c06a; background: rgba(201,168,76,0.05); }
.tm-drawer-section {
  font-family: 'EB Garamond', serif; font-style: italic;
  font-size: 0.72rem; color: rgba(201,168,76,0.38);
  letter-spacing: 3px; text-transform: uppercase;
  padding: 16px 28px 4px;
}
.tm-drawer .tm-sub {
  padding-left: 44px; font-size: 0.88rem;
  letter-spacing: 2px; color: rgba(201,168,76,0.62);
}
@media (max-width: 768px) {
  .tm-nav { --nav-h: 100px; }
  .tm-menu  { display: none !important; }
  .tm-hamburger { display: flex; }
  .tm-center-logo img { width: 52px !important; height: 52px !important; }
  .tm-center-logo .tm-ctitle span { font-size: 1rem !important; letter-spacing: 5px !important; }
  .tm-left-logo img { width: 46px; height: 46px; }
  .tm-left-logo .tm-ltitle { display: none; }
  .tm-f { font-size: 0.68rem !important; }
}
@media (min-width: 769px) and (max-width: 1100px) {
  .tm-left-logo .tm-ltitle { display: none; }
  .tm-menu > a,
  .tm-dd > a { font-size: 0.72rem; padding: 8px 6px; letter-spacing: 1.5px; }
}
@media (min-width: 769px) {
  .tm-hamburger { display: none !important; }
  .tm-drawer    { display: none !important; }
  #tm-toggle    { display: none !important; }
}

  /* ─── FOOTER ─── */
  footer {
    padding: 40px 40px 32px;
    border-top: 1px solid rgba(201,168,76,0.12);
  }

  .footer-inner {
    max-width: 1100px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 24px;
  }

  .footer-left {
    display: flex;
    align-items: center;
    gap: 14px;
    text-decoration: none;
  }

  .footer-left img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 1.5px solid rgba(201,168,76,0.4);
    object-fit: cover;
  }

  .footer-left .footer-brand {
    display: flex;
    flex-direction: column;
    line-height: 1.15;
  }

  .footer-left .footer-brand span {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 700;
    font-size: 0.85rem;
    color: rgba(201,168,76,0.7);
    letter-spacing: 4px;
    text-transform: uppercase;
  }

  .footer-copy {
    font-size: 0.72rem;
    color: var(--text-muted, #7A8BA3);
    margin-top: 8px;
    font-family: 'DM Sans', sans-serif;
    letter-spacing: 0;
    text-transform: none;
    font-weight: 400;
  }

  .footer-socials {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .footer-socials a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid rgba(201,168,76,0.15);
    background: rgba(201,168,76,0.04);
    transition: all 0.3s ease;
  }

  .footer-socials a:hover {
    border-color: rgba(201,168,76,0.4);
    background: rgba(201,168,76,0.1);
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(201,168,76,0.15);
  }

  .footer-socials a svg {
    width: 18px;
    height: 18px;
    fill: rgba(201,168,76,0.65);
    transition: fill 0.3s ease;
  }

  .footer-socials a:hover svg {
    fill: #e2c06a;
  }
  /* ─── Footer Legal Links ─── */
  .footer-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 16px;
  }

  .footer-legal {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .footer-legal a {
    color: rgba(201,168,76,0.5);
    text-decoration: none;
    font-size: 0.78rem;
    font-family: 'DM Sans', sans-serif;
    transition: color 0.3s ease;
    letter-spacing: 0.3px;
  }

  .footer-legal a:hover {
    color: #e2c06a;
  }

  @media (max-width: 600px) {
    .footer-right {
      align-items: center;
    }
    .footer-legal {
      justify-content: center;
      gap: 14px;
    }
  }


  @media (max-width: 600px) {
    .footer-inner {
      flex-direction: column;
      text-align: center;
      gap: 20px;
    }
    .footer-left {
      flex-direction: column;
      gap: 10px;
    }
    .footer-left .footer-brand {
      align-items: center;
    }
  }

</style>

<tm-header></tm-header>



<h1>Repère de Frenet</h1>
<p class="subtitle">Courbure & décomposition de l'accélération</p>

<div class="card" id="canvasWrap">
  <canvas id="cv"></canvas>
  <div class="overlay legend" id="legend"></div>
  <div class="overlay measures" id="measures"></div>
</div>

<div class="card">
  <div class="controls">
    <div class="section-label">Courbe</div>
    <div class="btn-row" id="curveButtons"></div>

    <div class="flex-row">
      <button class="btn play-btn active" id="playBtn" onclick="togglePlay()">⏸ Pause</button>
      <div class="slider-wrap">
        <label>Vitesse : <span id="speedVal">0.5</span>×</label>
        <input type="range" min="0.1" max="3" step="0.1" value="0.5" id="speedSlider" oninput="onSpeed(this.value)">
      </div>
    </div>

    <div class="flex-row" id="manualWrap" style="display:none">
      <div class="slider-wrap" style="min-width:100%">
        <label>Position manuelle</label>
        <input type="range" min="0" max="100" step="0.5" value="0" id="manualSlider" oninput="onManual(this.value)">
      </div>
    </div>

    <div class="section-label">Affichage</div>
    <div class="btn-row" id="toggleButtons"></div>
  </div>
</div>

<div class="card">
  <div class="formulas">
    <div class="section-label">Formules clés</div>
    <div class="formula-grid">
      <div class="formula-card t"><span style="color:var(--tangent)">T</span> = r′ / |r′|</div>
      <div class="formula-card n"><span style="color:var(--normal)">N</span> = T′ / |T′|</div>
      <div class="formula-card k">κ = |dT/ds| , R = 1/κ</div>
      <div class="formula-card a"><span style="color:var(--atotal)">a</span> = <span style="color:var(--at)">(dv/dt)</span><span style="color:var(--tangent)">T</span> + <span style="color:var(--an)">(v²/R)</span><span style="color:var(--normal)">N</span></div>
    </div>
  </div>
</div>

<script>
const CURVES = {
  ellipse:    { name:"Ellipse",    fn: t => ({ x:220*Math.cos(t), y:120*Math.sin(t) }), period: 2*Math.PI },
  lemniscate: { name:"Lemniscate", fn: t => { const s=Math.sin(t),c=Math.cos(t),d=1+s*s; return {x:200*c/d, y:200*s*c/d}; }, period: 2*Math.PI },
  spirale:    { name:"Spirale",    fn: t => { const r=60+30*t; return {x:r*Math.cos(t*1.5), y:r*Math.sin(t*1.5)}; }, period: 4*Math.PI },
  huit:       { name:"Figure 8",   fn: t => ({ x:200*Math.sin(t), y:120*Math.sin(2*t) }), period: 2*Math.PI },
};

let curveKey = "ellipse", playing = true, speed = 0.5, tParam = 0;
let showT = true, showN = true, showOsc = true, showDecomp = true, showAccel = true;

const toggles = [
  { key:"showT", label:"T tangent" },
  { key:"showN", label:"N normal" },
  { key:"showOsc", label:"Cercle osc." },
  { key:"showDecomp", label:"aₜ + aₙ" },
  { key:"showAccel", label:"a totale" },
];

// Build curve buttons
const cDiv = document.getElementById("curveButtons");
Object.entries(CURVES).forEach(([k,c]) => {
  const b = document.createElement("button");
  b.className = "btn" + (k === curveKey ? " active" : "");
  b.textContent = c.name;
  b.onclick = () => { curveKey = k; tParam = 0; updateCurveButtons(); };
  b.dataset.key = k;
  cDiv.appendChild(b);
});
function updateCurveButtons() {
  cDiv.querySelectorAll(".btn").forEach(b => b.classList.toggle("active", b.dataset.key === curveKey));
}

// Build toggle buttons
const tDiv = document.getElementById("toggleButtons");
toggles.forEach(t => {
  const b = document.createElement("button");
  b.className = "btn active";
  b.textContent = t.label;
  b.onclick = () => {
    window[t.key] = !window[t.key];
    b.classList.toggle("active", window[t.key]);
    updateLegend();
  };
  window[t.key] = true;
  tDiv.appendChild(b);
});

function togglePlay() {
  playing = !playing;
  const btn = document.getElementById("playBtn");
  btn.textContent = playing ? "⏸ Pause" : "▶ Play";
  btn.classList.toggle("active", playing);
  document.getElementById("manualWrap").style.display = playing ? "none" : "flex";
}
function onSpeed(v) { speed = parseFloat(v); document.getElementById("speedVal").textContent = speed.toFixed(1); }
function onManual(v) { tParam = (parseFloat(v)/100) * CURVES[curveKey].period; }

// Physics
const h = 0.0001;
function getData(curve, t) {
  const fn = curve.fn, p = fn(t), p1 = fn(t+h), p0 = fn(t-h);
  const dx=(p1.x-p0.x)/(2*h), dy=(p1.y-p0.y)/(2*h);
  const sp = Math.sqrt(dx*dx+dy*dy);
  const Tx=dx/sp, Ty=dy/sp;
  const d2x=(p1.x-2*p.x+p0.x)/(h*h), d2y=(p1.y-2*p.y+p0.y)/(h*h);
  const cross = dx*d2y - dy*d2x;
  const kappa = Math.abs(cross)/(sp*sp*sp);
  const R = kappa > 1e-8 ? 1/kappa : 1e6;
  const sign = cross >= 0 ? 1 : -1;
  const Nx=-Ty*sign, Ny=Tx*sign;
  const dSpeed = Tx*d2x + Ty*d2y;
  const aN = sp*sp*kappa;
  const cx = p.x+Nx*R, cy = p.y+Ny*R;
  return { p, Tx, Ty, Nx, Ny, speed:sp, kappa, R, dSpeed, aN, cx, cy };
}

// Canvas
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");
let W, H;

function resize() {
  const w = cv.parentElement.clientWidth;
  const dpr = window.devicePixelRatio || 1;
  W = w; H = Math.min(w * 0.7, 420);
  cv.width = W * dpr; cv.height = H * dpr;
  cv.style.height = H + "px";
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
resize();
window.addEventListener("resize", resize);

function updateLegend() {
  let html = "";
  if (showT) html += `<div><span style="color:var(--tangent)">━━</span> T tangent</div>`;
  if (showN) html += `<div><span style="color:var(--normal)">━━</span> N normal</div>`;
  if (showDecomp) {
    html += `<div><span style="color:var(--at)">━━</span> aₜ tangentielle</div>`;
    html += `<div><span style="color:var(--an)">━━</span> aₙ normale</div>`;
  }
  if (showAccel) html += `<div><span style="color:var(--atotal)">━━</span> a totale</div>`;
  if (showOsc) html += `<div><span style="color:var(--osc)">- -</span> cercle osculateur</div>`;
  document.getElementById("legend").innerHTML = html;
}
updateLegend();

function updateMeasures(d) {
  document.getElementById("measures").innerHTML =
    `<div class="label">Mesures</div>` +
    `<div>κ = <span>${d.kappa.toFixed(4)}</span></div>` +
    `<div>R = <span>${d.R > 999 ? "∞" : d.R.toFixed(1)}</span></div>` +
    `<div>v = <span>${d.speed.toFixed(1)}</span></div>` +
    `<div>aₜ = <span style="color:var(--at)">${d.dSpeed.toFixed(1)}</span></div>` +
    `<div>aₙ = <span style="color:var(--an)">${d.aN.toFixed(1)}</span></div>`;
}

function drawArrow(ox,oy,dx,dy,color,label,len) {
  const ex=ox+dx*len, ey=oy+dy*len;
  const a=Math.atan2(dy,dx), hl=8;
  ctx.shadowColor=color; ctx.shadowBlur=6;
  ctx.beginPath(); ctx.strokeStyle=color; ctx.lineWidth=2.2;
  ctx.moveTo(ox,oy); ctx.lineTo(ex,ey); ctx.stroke();
  ctx.beginPath(); ctx.fillStyle=color;
  ctx.moveTo(ex,ey);
  ctx.lineTo(ex-hl*Math.cos(a-0.35), ey-hl*Math.sin(a-0.35));
  ctx.lineTo(ex-hl*Math.cos(a+0.35), ey-hl*Math.sin(a+0.35));
  ctx.closePath(); ctx.fill();
  ctx.shadowBlur=0;
  if(label) { ctx.fillStyle=color; ctx.font="bold italic 13px 'Playfair Display',serif"; ctx.fillText(label, ex+dx*12-4, ey+dy*12+4); }
}

let lastTime = null;
function loop(ts) {
  if (lastTime !== null && playing) {
    const dt = (ts - lastTime) / 1000;
    tParam += dt * speed * 1.2;
    const per = CURVES[curveKey].period;
    if (tParam > per) tParam -= per;
    if (tParam < 0) tParam += per;
  }
  lastTime = ts;

  const curve = CURVES[curveKey];
  const d = getData(curve, tParam);
  const mx = W/2, my = H/2;

  // BG
  const gr = ctx.createRadialGradient(mx,my,0,mx,my,W*0.6);
  gr.addColorStop(0,"#0f1729"); gr.addColorStop(1,"#0a0e1a");
  ctx.fillStyle=gr; ctx.fillRect(0,0,W,H);

  // Grid dots
  ctx.fillStyle="#1a2340";
  for(let x=0;x<W;x+=25) for(let y=0;y<H;y+=25) { ctx.beginPath(); ctx.arc(x,y,0.6,0,6.28); ctx.fill(); }

  // Curve
  ctx.beginPath(); ctx.strokeStyle="#334155"; ctx.lineWidth=1.2;
  for(let i=0;i<=500;i++) {
    const tt=(i/500)*curve.period, pp=curve.fn(tt);
    i===0 ? ctx.moveTo(mx+pp.x,my+pp.y) : ctx.lineTo(mx+pp.x,my+pp.y);
  }
  ctx.stroke();

  // Trail
  ctx.beginPath(); ctx.strokeStyle="#475569"; ctx.lineWidth=2; ctx.globalAlpha=0.4;
  const trail = curve.period*0.15;
  for(let i=0;i<=80;i++) {
    const tt=tParam-trail+(trail*i)/80, pp=curve.fn(tt);
    i===0 ? ctx.moveTo(mx+pp.x,my+pp.y) : ctx.lineTo(mx+pp.x,my+pp.y);
  }
  ctx.stroke(); ctx.globalAlpha=1;

  // Osculating circle
  if(showOsc && d.R<500) {
    ctx.beginPath(); ctx.strokeStyle="#1e3a5f"; ctx.lineWidth=1.2; ctx.setLineDash([5,3]);
    ctx.arc(mx+d.cx, my+d.cy, d.R, 0, 6.28); ctx.stroke(); ctx.setLineDash([]);
    ctx.beginPath(); ctx.fillStyle="#1e3a5f"; ctx.arc(mx+d.cx,my+d.cy,2.5,0,6.28); ctx.fill();
    ctx.fillStyle="#3b6b9a"; ctx.font="italic 11px 'Playfair Display',serif";
    ctx.fillText("R", mx+(d.p.x+d.cx)/2+5, my+(d.p.y+d.cy)/2-3);
  }

  const px=mx+d.p.x, py=my+d.p.y, aLen=60;

  if(showT) drawArrow(px,py,d.Tx,d.Ty,"#22d3ee","T",aLen);
  if(showN) drawArrow(px,py,d.Nx,d.Ny,"#f472b6","N",aLen);

  if(showDecomp) {
    const sc=0.07;
    const atL=Math.abs(d.dSpeed)*sc, anL=d.aN*sc;
    const atS=d.dSpeed>=0?1:-1;
    if(atL>2) drawArrow(px,py,d.Tx*atS,d.Ty*atS,"#facc15","aₜ",Math.min(atL,80));
    if(anL>2) drawArrow(px,py,d.Nx,d.Ny,"#fb923c","aₙ",Math.min(anL,80));
    if(showAccel) {
      const ax=d.dSpeed*d.Tx+d.aN*d.Nx, ay=d.dSpeed*d.Ty+d.aN*d.Ny;
      const am=Math.sqrt(ax*ax+ay*ay);
      if(am>0.1) drawArrow(px,py,ax/am,ay/am,"#ef4444","a",Math.min(am*sc,90));
    }
  }

  // Point
  ctx.shadowColor="#fff"; ctx.shadowBlur=12;
  ctx.beginPath(); ctx.fillStyle="#fff"; ctx.arc(px,py,4.5,0,6.28); ctx.fill();
  ctx.shadowBlur=0;
  ctx.beginPath(); ctx.strokeStyle="rgba(255,255,255,0.3)"; ctx.lineWidth=1.2;
  ctx.arc(px,py,8,0,6.28); ctx.stroke();

  updateMeasures(d);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
<tm-footer></tm-footer>

<script src="components.js"></script>
<script src="/cookie-consent.js"></script>
</body>
</html>
